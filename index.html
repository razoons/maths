<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Jeux de Maths</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cherry+Bomb+One&display=swap" rel="stylesheet">
    <link rel="manifest" href="/maths/manifest.webmanifest">
    <meta name="theme-color" content="#0ea5e9">
    <link rel="icon" href="/maths/icon-192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="/maths/icon-192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.5.4/dist/vuetify.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.5.4/dist/vuetify.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="app">
        <v-app>
            <v-main class="pa-4 d-flex ga-16 flex-column align-stretch justify-center h-100"
                style="background-color:#0aaee3">

                <div class="flex-grow-1 d-flex align-center justify-center">
                    <v-btn size="x-large" rounded="pill"
                        class="h-auto border-lg d-flex text-h1 elevation-24 ma-auto w-90 font-kid" @click="goToGame"
                        color="#f78d17">
                        Jouer
                    </v-btn>
                </div>

                <div class="flex-grow-1 d-flex align-center justify-center">
                    <v-btn size="x-large" rounded="pill"
                        class="h-auto border-lg d-flex text-h1 elevation-24 ma-auto w-90 font-kid" @click="goToRewards"
                        color="#f78d17">
                        Mes rÃ©compenses
                    </v-btn>
                </div>
            </v-main>
        </v-app>
    </div>
    <script>
        const { createApp, ref, onMounted } = Vue;
        const { createVuetify } = Vuetify;



        const app = createApp({
            setup() {
                function goToGame() {
                    window.location.href = "./game.html";
                }
                function goToRewards() {
                    window.location.href = "./rewards.html";
                }
                return { goToGame, goToRewards };
            }
        });

        const vuetify = createVuetify();
        app.use(vuetify);
        app.mount('#app');
    </script>
    <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", async () => {
                try {
                    const reg = await navigator.serviceWorker.register("/maths/service-worker.js", { scope: "/maths/" });
                    // (optionnel) auto-update du SW
                    setInterval(() => reg.update(), 60 * 60 * 1000); // toutes les heures

                    // (optionnel) activer la nouvelle version immÃ©diatement
                    navigator.serviceWorker.addEventListener("controllerchange", () => {
                        // tu peux rafraÃ®chir lâ€™UI ici si besoin
                    });
                } catch (e) {
                    console.error("SW registration failed", e);
                }
            });
        }

        window.addEventListener("beforeinstallprompt", (e) => {
            console.log("âœ… beforeinstallprompt fired");
            e.preventDefault(); // tu peux aussi stocker lâ€™event et proposer un bouton custom

            deferredPrompt = e;

            // CrÃ©e un bouton Installer
            const btn = document.createElement("button");
            btn.textContent = "ðŸ“² Installer l'application";
            btn.style.position = "fixed";
            btn.style.bottom = "20px";
            btn.style.right = "20px";
            btn.style.padding = "10px";
            btn.style.zIndex = 9999;

            btn.addEventListener("click", async () => {
                deferredPrompt.prompt(); // ðŸ”¥ dÃ©clenche lâ€™installation
                const { outcome } = await deferredPrompt.userChoice;
                console.log("RÃ©sultat installation :", outcome);
                deferredPrompt = null;
                btn.remove(); // supprime le bouton aprÃ¨s
            });

            document.body.appendChild(btn);
        });

    </script>
</body>

</html>